<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SharePoint URL Builder</title>
    <script src="https://res.cdn.office.net/teams-js/2.19.0/js/MicrosoftTeams.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .info-group {
            margin-bottom: 20px;
        }
        .info-label {
            font-weight: bold;
            color: #444;
            margin-bottom: 5px;
        }
        .info-value {
            padding: 8px;
            background: #f8f9fa;
            border-radius: 4px;
            border: 1px solid #dee2e6;
            word-break: break-all;
        }
        .url-section {
            margin-top: 30px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 4px;
        }
        button {
            background: #0078d4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }
        button:hover {
            background: #006abc;
        }
        .success-message {
            color: #28a745;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>
     <div class="container">
        <h1>SharePoint URL Builder <small style="font-size: 0.6em; color: #666;">v1.1</small></h1>
        <div class="info-group">
            <div class="info-label">Tenant:</div>
            <div id="tenantName" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Team ID:</div>
            <div id="teamId" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Team Name:</div>
            <div id="teamName" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Channel ID:</div>
            <div id="channelId" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Channel Name:</div>
            <div id="channelName" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Channel Type:</div>
            <div id="channelType" class="info-value">Loading...</div>
        </div>
        <div class="url-section">
            <div class="info-label">Generated Document library URL:</div>
            <div id="sharepointUrl" class="info-value">Loading...</div>
            <button onclick="copyUrl()">Copy URL</button>
            <div id="copySuccess" class="success-message">URL copied to clipboard!</div>
        </div>
    </div> 
 <iframe
    width="800"
    height="600"
    src="https://apps.powerapps.com/play/3243308d-d91c-4948-a5e3-e98e3a7d8ae5?source=website"
    allow="geolocation; microphone; camera; display-capture;"
></iframe>
    <script src="app.js"></script>
</body>
</html> -->


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power App Embed with Teams Context</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; }
        .info-group { display: flex; margin-bottom: 10px; }
        .info-label { font-weight: bold; width: 120px; }
        .info-value { flex-grow: 1; }
        #powerAppIframe { border: 1px solid #ddd; } /* Add some styling to the iframe */
        .success-message { color: green; margin-top: 10px; display: none; }
    </style>
</head>
<body>

    <div class="container">
        <h1>SharePoint URL Builder <small style="font-size: 0.6em; color: #666;">v1.1</small></h1>
        <div class="info-group">
            <div class="info-label">Tenant:</div>
            <div id="tenantIdDisplay" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Team ID:</div>
            <div id="teamIdDisplay" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Team Name:</div>
            <div id="teamNameDisplay" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Channel ID:</div>
            <div id="channelIdDisplay" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Channel Name:</div>
            <div id="channelNameDisplay" class="info-value">Loading...</div>
        </div>
        <div class="info-group">
            <div class="info-label">Channel Type:</div>
            <div id="channelTypeDisplay" class="info-value">Loading...</div>
        </div>
        <div class="url-section">
            <div class="info-label">Generated Document library URL:</div>
            <div id="sharepointUrl" class="info-value">Loading...</div>
            <button onclick="copyUrl()">Copy URL</button>
            <div id="copySuccess" class="success-message">URL copied to clipboard!</div>
        </div>
    </div>

    <iframe
        id="powerAppIframe"
        width="800"
        height="600"
        src="" allow="geolocation; microphone; camera; display-capture;"
    ></iframe>

    <script>
        // *** IMPORTANT: You need to get these values from your Teams context
        //    This is pseudo-code for how you'd likely retrieve them in a Teams Tab context
        //    using Microsoft Teams JavaScript SDK (microsoftTeams.getContext)
        //    For this example, I'm hardcoding them for demonstration.
        //    Replace with your actual logic to get the context from Teams or SharePoint.

        // Example hardcoded values (REPLACE THESE WITH YOUR ACTUAL LOGIC)
        let tenantId = 'af174864-f28c-4596-bae6-1123b5d70544'; // Your actual tenant ID
        let teamId = 'a1b2c3d4-e5f6-7890-1234-567890abcdef'; // Example Team ID
        let teamName = 'My Awesome Team'; // Example Team Name
        let channelId = 'z9y8x7w6-v5u4-3210-9876-543210fedcba'; // Example Channel ID
        let channelName = 'General'; // Example Channel Name (or 'My Private Channel')
        let channelType = 'Standard'; // Example Channel Type (or 'Private')

        // Function to populate the display divs (from your original commented HTML)
        function populateInfoDisplays() {
            document.getElementById('tenantIdDisplay').innerText = tenantId;
            document.getElementById('teamIdDisplay').innerText = teamId;
            document.getElementById('teamNameDisplay').innerText = teamName;
            document.getElementById('channelIdDisplay').innerText = channelId;
            document.getElementById('channelNameDisplay').innerText = channelName;
            document.getElementById('channelTypeDisplay').innerText = channelType;
            // You'd also update sharepointUrl here
            document.getElementById('sharepointUrl').innerText = `https://yourtenant.sharepoint.com/sites/${teamName.replace(/\s/g, '')}/Shared%20Documents`;
        }

        // Function to build and set the iframe src
        function setPowerAppIframeSrc() {
            const appID = '3243308d-d91c-4948-a5e3-e98e3a7d8ae5';
            let powerAppUrl = `https://apps.powerapps.com/play/${appID}?source=website`;

            // Append Teams context parameters
            powerAppUrl += `&paramTenantId=${encodeURIComponent(tenantId)}`;
            powerAppUrl += `&paramTeamId=${encodeURIComponent(teamId)}`;
            powerAppUrl += `&paramTeamName=${encodeURIComponent(teamName)}`;
            powerAppUrl += `&paramChannelId=${encodeURIComponent(channelId)}`;
            powerAppUrl += `&&paramChannelName=${encodeURIComponent(channelName)}`; // Double ampersand for consistency if this is the 6th param
            powerAppUrl += `&paramChannelType=${encodeURIComponent(channelType)}`;


            const iframe = document.getElementById('powerAppIframe');
            if (iframe) {
                iframe.src = powerAppUrl;
            }
            console.log("Generated Power App URL:", powerAppUrl); // For debugging
        }

        // Call these functions when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            // In a real Teams tab, you'd use microsoftTeams.app.getContext() here
            // to get the actual tenantId, teamId, etc.
            // For this example, we're assuming these variables are populated by some means.
            populateInfoDisplays();
            setPowerAppIframeSrc();
        });

        // Your existing copyUrl function (if any)
        function copyUrl() {
            const urlText = document.getElementById('sharepointUrl').innerText;
            navigator.clipboard.writeText(urlText).then(() => {
                const successMessage = document.getElementById('copySuccess');
                successMessage.style.display = 'block';
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy URL: ', err);
            });
        }
    </script>

</body>
</html>
